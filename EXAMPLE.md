# Примеры новых вариантов использования кода системы HiTViSc

## Установка системы

Установка back-end производится из директории [install](install) с предварительной настройкой параметров системы, как описано в файле [README](README.md).

Для установки back-end выполняется следующий набор скриптов:
```
ansible-playbook hitvisc-install.yml
ansible-playbook hitvisc-main-install.yml
ansible-playbook boinc-install.yml
ansible-playbook hitvisc-boinc-install.yml
ansible-playbook postgresql-install.yml
ansible-playbook registry-install.yml
ansible-playbook third-party-install.yml
```

Соответствующий набор скриптов используется для удаления всех компонент:
```
ansible-playbook third-party-remove.yml
ansible-playbook registry-remove.yml
ansible-playbook postgresql-remove.yml
ansible-playbook boinc-remove.yml
ansible-playbook hitvisc-main-remove.yml
ansible-playbook hitvisc-remove.yml
```

Front-end реализован с использование фреймворка Nuxt3, для его установки, генерации образа установки и образа развертывания конечной системы используются следующие команды.
```
# npm
npm install
# pnpm
pnpm install
# yarn
yarn install
# bun
bun install

# npm
npm run dev

# pnpm
pnpm run dev
# yarn
yarn dev
# bun
bun run dev

# npm
npm run build
# pnpm
pnpm run build
# yarn
yarn build
# bun
bun run build
```

Работа сервиса HiTViSc обеспечивается контейнером Docker с настройками, указанными в файле [frontend/docker-compose.staging.yml](frontend/docker-compose.staging.yml).




## Пример 1: виртуальный скрининг с использованием программы молекулярного докинга AutoDock Vina

**Мишень:** ретиноид-связанный орфанный рецептор-α человека (RORα), PDB ID: [1S0X](https://www.rcsb.org/structure/1S0X). Это лиганд-зависимый транскрипционный фактор: в ответ на связывание эндогенного или экзогенного лиганда он изменяет конформацию, ассоциирует с коактиватором или корепрессором и, соответственно, стимулирует или подавляет транскрипцию генов-мишеней. Поскольку транскрипционная активность RORα зависит от связывания лиганда, актуальна задача поиска ингибиторов, способствующих регуляции данного фактора. 

Подготовка мишени в системе HiTViSc: в веб-интерфейсе системы, в форме добавления мишени, ввести данные и нажать "Добавить".

![image](https://github.com/user-attachments/assets/15ea461b-a32f-41e8-bb75-4d7a816ae9e3)

В случае успешного добавления мишень станет доступна в библиотеке мишеней.

**Коллекция лигандов:** фрагмент открытой библиотеки [ZINC15](https://zinc15.docking.org), содержащий 20000 малых молекул из числа ранее отобранных и прошедших экспертную подготовку к виртуальному скринингу ([см. статью](https://doi.org/10.3390/molecules26103003)).

Подготовка коллекции лигандов в системе HiTViSc: в веб-интерфейсе системы, в форме добавления коллекции лигандов, ввести данные и нажать "Добавить". Добавление занимает около 50 минут на сервере с конфигурацией 2 Intel(R) Xeon(R) Gold 6240 CPU @ 2.60GHz, 4GB RAM. 

![image](https://github.com/user-attachments/assets/eabd4448-14c9-494d-87e7-566ee51cb8e3)

В случае успешного добавления коллекция станет доступна в библиотеке коллекций лигандов.

**Создание вычислительного эксперимента виртуального скрининга:** в веб-интерфейсе системы, в форме создания проекта на Шаге 1, ввести данные об эксперименте и перейти к следующему шагу.

![image](https://github.com/user-attachments/assets/7a0624a0-d1d8-407e-8ad0-d29579d396bb)

**Приложение и протокол молекулярного докинга:** в веб-интерфейсе системы, в форме создания проекта на Шаге 2, выбрать расчетное приложение AutoDock Vina и загрузить файл с параметрами протокола молекулярного докинга. Задан протокол молекулярного докинга со средней точностью (использованное значение входного параметра exhaustiveness = 4 соответствует средней точности, а сам параметр связывает скорость и точность расчетов линейно), позволяющей быстро, но достаточно точно провести расчеты. Среди результатов выбирается одна наилучшая по энергии связывания конформация лиганда. Нажать "Далее".

![image](https://github.com/user-attachments/assets/08764df8-6a54-4139-87ba-5b6665d6868c)

**Критерий отбора хитов и критерий остановки:** в веб-интерфейсе системы, в форме создания проекта на Шаге 3, установить значение критерия отбора хитов "Энергия связывания", равное -8 ккал/моль. Установить значение критерия остановки "% проверенных лигандов", равное 100. Выбрать желаемый тип вычислительных ресурсов и нажать "Далее".

![image](https://github.com/user-attachments/assets/4ee74753-9dbb-4800-9340-2c9a9cd65e7d)

**Запуск эксперимента:** в веб-интерфейсе системы, в форме создания проекта на Шаге 4, нажать "Далее". В случае успешного создания, карточка нового проекта появится в библиотеке проектов со сначала неактивной кнопкой "Результаты".

**Проведение эксперимента:** после создания проекта, система HiTViSc автоматически создаст рабочие задания, которые будут выполнены подключенными к системе вычислительными узлами (BOINC-клиентами). Результаты будут автоматически обработаны на сервере системы. Когда все результаты будут обработаны, в карточке проекта станет активна кнопка "Результаты". При нажатии на нее появятся ссылки на скачивание файлов результатов: все хиты, химически разнообразные хиты и визуализация множества хитов. 

## Пример 2: виртуальный скрининг с использованием программы молекулярного докинга CmDock

**Мишень:** основная протеаза коронавируса SARS-CoV-2 (3CLpro), PDB ID: [6Y7M](https://www.rcsb.org/structure/6Y7M). Это одна из протеаз, имеющих важное функциональное значение в жизненном цикле коронавируса при отсутствии близких гомологов у человека, что делает ее перспективной мишенью в поисках противовирусных препаратов с минимальной токсичностью для клеток человеческого организма. Подготовленная экспертом 3D-структура белка в формате PDB и параметры молекулярного докинга были получены из исходных данных проекта добровольных вычислений SiDock@home. Подготовленная 3D-структура белка в формате MOL2 встроена в систему HiTViSc в качестве предустановленной мишени "Example target for CmDock", отображается в библиотеке мишеней и доступна для выбора при создании нового проекта.

**Коллекция лигандов:** фрагмент открытой библиотеки [ZINC15](https://zinc15.docking.org), содержащий 20000 малых молекул из числа ранее отобранных и прошедших экспертную подготовку к виртуальному скринингу ([см. статью](https://doi.org/10.3390/molecules26103003)). При успешной загрузке коллекции лигандов (см. Пример 1), она отображается в библиотеке коллекций лигандов и доступна для выбора при создании нового проекта.

**Создание вычислительного эксперимента виртуального скрининга:** в веб-интерфейсе системы, в форме создания проекта на Шаге 1, ввести данные об эксперименте и перейти к следующему шагу.

**Приложение и протокол молекулярного докинга:** в веб-интерфейсе системы, в форме создания проекта на Шаге 2, выбрать расчетное приложение CmDock и загрузить файлы с параметрами протокола молекулярного докинга. Задан протокол молекулярного докинга, подготовленный экспертом – автором программы CmDock и апробированный в проекте SiDock@home, позволяющий с достаточной скоростью и точностью провести расчеты. Среди результатов выбиралась одна наилучшая конформация лиганда. Нажать "Далее".

**Критерий отбора хитов и критерий остановки:** в веб-интерфейсе системы, в форме создания проекта на Шаге 3, установить значение критерия отбора хитов "Энергия связывания", равное -21 ккал/моль. Установить значение критерия остановки "% проверенных лигандов", равное 100. Выбрать желаемый тип вычислительных ресурсов и нажать "Далее".

**Запуск эксперимента:** в веб-интерфейсе системы, в форме создания проекта на Шаге 4, нажать "Далее". В случае успешного создания, карточка нового проекта появится в библиотеке проектов со сначала неактивной кнопкой "Результаты".

**Проведение эксперимента:** после создания проекта, система HiTViSc автоматически создаст рабочие задания, которые будут выполнены подключенными к системе вычислительными узлами (BOINC-клиентами). Результаты будут автоматически обработаны на сервере системы. Когда все результаты будут обработаны, в карточке проекта станет активна кнопка "Результаты". При нажатии на нее появятся ссылки на скачивание файлов результатов: все хиты, химически разнообразные хиты и визуализация множества хитов. 


Входные файлы примеров и выходные файлы с результатами представлены в репозитории в папке [example](example). Содержание файлов следующее:
1.  Файлы описания мишени для AutoDock Vina:
-  [example/hitvisc.target.autodockvina.example.pdbqt](example/hitvisc.target.autodockvina.example.pdbqt) – описание мишени RORα в формате для молекулярного докинга;
-  [example/hitvisc.target.autodockvina.example.refligand.pdbqt](example/hitvisc.target.autodockvina.example.refligand.pdbqt) – описание справочного лиганда в формате для молекулярного докинга;
-  [example/hitvisc.target.autodockvina.example.refligand_out.pdbqt](example/hitvisc.target.autodockvina.example.refligand_out.pdbqt) – результат молекулярного докинга справочного лиганда;
-  [example/hitvisc.docker_protocol.autodockvina.example.txt](example/hitvisc.docker_protocol.autodockvina.example.txt) – протокол молекулярного докинга;
2.  Файлы описания мишени для CmDock:
-  [example/hitvisc.target.cmdock.example.mol2](example/hitvisc.target.cmdock.example.mol2) – описание мишени 3CLpro в формате для молекулярного докинга;
-  [example/corona_3CLpro_v3.prm](example/corona_3CLpro_v3.prm), [example/corona_3CLpro_v3.as](example/corona_3CLpro_v3.as), [example/htvs.ptc](example/htvs.ptc) – тройка файлов, задающих протокол молекулярного докинга в формате CmDock;
3.  Файл библиотеки лигандов:
-  [example/lib_sidock_20000_ligands.zip](example/lib_sidock_20000_ligands.zip) – исходный архив библиотеки лигандов;
4.  Файлы результатов виртуального скрининга для AutoDock Vina:
-  [example/example_autodockvina_hits_all.zip](example/example_autodockvina_hits_all.zip) – все полученные хиты;
-  [example/example_autodockvina_hits_div.zip](example/example_autodockvina_hits_div.zip) – таблица химического разнообразия;
-  [example/example_autodockvina_hits_viz.zip](example/example_autodockvina_hits_viz.zip) – визуализация;
5.  Файлы результатов виртуального скрининга для CmDock:
-  [example/example_cmdock_hits_all.zip](example/example_cmdock_hits_all.zip) – все полученные хиты;
-  [example/example_cmdock_hits_div.zip](example/example_cmdock_hits_div.zip) – таблица химического разнообразия;
-  [example/example_cmdock_hits_viz.zip](example/example_cmdock_hits_viz.zip) – визуализация.

